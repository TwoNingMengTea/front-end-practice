---
title: 富文本编辑器导入HTML的解决方案
date: 2020-01-19
tags: 

- 富文本编辑器

author: Lemon
---
当你遇到 “富文本编辑器需支持导入HTML” 这个需求时，你会如何处理？

<!-- more -->

## 前言

当你遇到 “富文本编辑器需支持导入HTML” 这个需求时，你会如何处理？

> 我想，大多数人遇到这个需求，一定会觉得这也太简单了把。分为以下几步，不就可以完美解决吗？
> 1. 找个熟悉的富文本编辑器，且编辑器支持HTML导入
> 2. 着手代码开发，轻松调用富文本编辑器自带API，实现HTML插入。
> 3. 美滋滋等待项目上线

直到PM突然联系你，客户反馈落差感很大，你会发现...

+ 买家秀01.png   ```VS```   卖家秀01.png

<div>
	<img src="/images/editor/default-01.png" width="300px" alt="买家秀01" style="box-shadow: 0 0 4px 0 rgba(0,0,0,.2);" />
	<span style="padding: 0 2em;">VS</span>
	<img src="/images/editor/question-01.png" width = "300px" alt="卖家秀01" style="box-shadow: 0 0 4px 0 rgba(0,0,0,.2);"/>
</div>
<br/>

+ 买家秀02.png   ```VS```   卖家秀02.png

<div>
	<img src="/images/editor/default-02.jpg" width="300px" alt="买家秀02" style="box-shadow: 0 0 4px 0 rgba(0,0,0,.2);"/>
	<span style="padding: 0 2em;">VS</span>
	<img src="/images/editor/question-02.jpg" width = "300px" alt="卖家秀02" style="box-shadow: 0 0 4px 0 rgba(0,0,0,.2);"/>
</div>
<br/>

+ 买家秀02.png   ```VS```   卖家秀02.png<div>
	<img src="/images/editor/default-03.png" width="300px" alt="买家秀03" style="box-shadow: 0 0 4px 0 rgba(0,0,0,.2);"/>
	<span style="padding: 0 2em;">VS</span>
	<img src="/images/editor/question-03.png" width = "300px" alt="卖家秀03" style="box-shadow: 0 0 4px 0 rgba(0,0,0,.2);"/>
</div>

+ 买家秀+N.png   ```VS```   卖家秀+N.png
亲！简直无法直视呀~

## 问题分析
> 事出必有其因，这个Bug也太妖孽了把~看我慢慢解析你。
> 在不断的自测、实践中，我发现了以下问题：
> 1. 存在图片放大、变形问题（未设置最大宽度）。
> 2. 存在样式丢失问题（说明源码中不含特殊样式）。
> 3. 在导入的过程中如果HTML的空格、换行有变化，也会导致样式变化。（参考买家秀02，说明css的写法存在一定兼容性问题）
> 4. 直接访问HTML源码显示错乱（自家编辑器不含特殊处理，说明HTML本身就有问题）。
> 5.```买家秀``` 效果来自135编辑器, ```卖家秀```效果来自自家编辑器（tinymce插件）和解释器（前台）。
> 6. HTML源码在```135编辑器```中显示ok， 在自家编辑器效果中以及解释器中显示错乱。
> 7. PC和Mobile的效果差别很大（这是一个响应式的网页项目）。
> 8. 135编辑器是一个现有的编辑器产品， 无法在自家项目中使用。
> 9.客户主要使用135编辑器

由此得知，出现这样的问题是因为其他编辑器在导入我们编辑器的过程中，出现了兼容性问题。
这个兼容性问题出在第三方，在编辑HTML的时候作出了特殊处理，且没有把源码保存在HTML中。

## 问题修复
> 虽然问题出在第三方，但是我们必须要解决。因为这严重影响了用户体验。
> 用户主要使用135编辑器，所以我们以135编辑器为标杆做了相应的解决方案。
> 解决方案如下：
> 1. 找出第三方编辑器（135编辑器）作出的特殊处理（修复样式丢失问题）
> 2. 压缩HTML代码，去除多余空格（修复糟糕的CSS的写法导致的兼容性问题）。
> 3. 编辑器的容器大小和135编辑器的容器大小保持一致（防止容器过大导致的变形）。
> 4. 设置容器最大宽度（防止溢出）。

## 实施过程
> 1. 将第三方编辑器（135编辑器）使用的CSS外部样式表下载下来，放入自家编辑器（后台）以及解释器（前台）中。
> 2. 在编辑器（后台），压缩导入的HTML代码，去除多余空格
> 3. 编辑器的容器（后台）大小、解释器的容器（前台）大小和135编辑器的容器大小保持一致
> 4. 设置容器最大宽度, 图片最大宽度
> 5. 让PM找客户提供所有的HTML素材，内部测试，平稳过渡

## 总结
1. 这个问题看似是一个简单的HTML导入的功能，其实是兼容第三方平台导入的功能。
2. 因为135编辑器是一个现有的、不断维护的产品，我们也需要定期去更新自己的平台。
3. 遇到问题不要慌，能理清问题本身，就离解决问题不远了。
4. 留给大家一个问题，如何更好的提升用户满意度？